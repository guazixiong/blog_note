<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql快速生成千万数据 | 瓜子熊碎碎碎念</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/pbad_note/favicon.ico">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?2675818a983a3131404cee835018f016";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script>
    <meta name="description" content="贴心的编程学习路线，全面的编程知识百科">
    <meta property="og:site_name" content="瓜子熊碎碎碎念">
    <meta property="og:title" content="Mysql快速生成千万数据">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://codefather.cn/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html">
    <meta name="twitter:title" content="Mysql快速生成千万数据">
    <meta name="twitter:url" content="https://codefather.cn/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="程序员, 编程, 计算机">
    <meta property="article:tag" content="程序员">
    <meta name="keywords" content="编程, Java, 开发, 编程分享, 项目, IT, 求职, 面经, 赚钱">
    
    <link rel="preload" href="/pbad_note/assets/css/0.styles.3a72e05f.css" as="style"><link rel="preload" href="/pbad_note/assets/js/app.e274ab40.js" as="script"><link rel="preload" href="/pbad_note/assets/js/2.fd06b53e.js" as="script"><link rel="preload" href="/pbad_note/assets/js/33.2b5112ad.js" as="script"><link rel="prefetch" href="/pbad_note/assets/js/1.17ea1209.js"><link rel="prefetch" href="/pbad_note/assets/js/10.d9532d8f.js"><link rel="prefetch" href="/pbad_note/assets/js/11.2f89b5eb.js"><link rel="prefetch" href="/pbad_note/assets/js/12.53aaa509.js"><link rel="prefetch" href="/pbad_note/assets/js/13.52940164.js"><link rel="prefetch" href="/pbad_note/assets/js/14.ade1e74d.js"><link rel="prefetch" href="/pbad_note/assets/js/15.970a8ca5.js"><link rel="prefetch" href="/pbad_note/assets/js/16.ff971500.js"><link rel="prefetch" href="/pbad_note/assets/js/17.4b045b26.js"><link rel="prefetch" href="/pbad_note/assets/js/18.1cdd0514.js"><link rel="prefetch" href="/pbad_note/assets/js/19.5740e4d6.js"><link rel="prefetch" href="/pbad_note/assets/js/20.8885a4fa.js"><link rel="prefetch" href="/pbad_note/assets/js/21.0bb62db4.js"><link rel="prefetch" href="/pbad_note/assets/js/22.3e8347a6.js"><link rel="prefetch" href="/pbad_note/assets/js/23.ceb5a5ff.js"><link rel="prefetch" href="/pbad_note/assets/js/24.07267ac6.js"><link rel="prefetch" href="/pbad_note/assets/js/25.15e1f641.js"><link rel="prefetch" href="/pbad_note/assets/js/26.35b2bbdc.js"><link rel="prefetch" href="/pbad_note/assets/js/27.63afc9a1.js"><link rel="prefetch" href="/pbad_note/assets/js/28.7fb869b7.js"><link rel="prefetch" href="/pbad_note/assets/js/29.64077b29.js"><link rel="prefetch" href="/pbad_note/assets/js/3.4dc033c7.js"><link rel="prefetch" href="/pbad_note/assets/js/30.676381ec.js"><link rel="prefetch" href="/pbad_note/assets/js/31.707822a5.js"><link rel="prefetch" href="/pbad_note/assets/js/32.a3c7ba08.js"><link rel="prefetch" href="/pbad_note/assets/js/34.4ec73895.js"><link rel="prefetch" href="/pbad_note/assets/js/35.9f3636f9.js"><link rel="prefetch" href="/pbad_note/assets/js/36.3c10efd7.js"><link rel="prefetch" href="/pbad_note/assets/js/37.0991b756.js"><link rel="prefetch" href="/pbad_note/assets/js/38.ebb8eb8b.js"><link rel="prefetch" href="/pbad_note/assets/js/39.2175d9f4.js"><link rel="prefetch" href="/pbad_note/assets/js/4.2f502b73.js"><link rel="prefetch" href="/pbad_note/assets/js/40.1678c023.js"><link rel="prefetch" href="/pbad_note/assets/js/5.7b1f056c.js"><link rel="prefetch" href="/pbad_note/assets/js/6.056886f1.js"><link rel="prefetch" href="/pbad_note/assets/js/7.a96cecf9.js"><link rel="prefetch" href="/pbad_note/assets/js/vendors~docsearch.33b2b47d.js">
    <link rel="stylesheet" href="/pbad_note/assets/css/0.styles.3a72e05f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/pbad_note/" class="home-link router-link-active"><img src="/pbad_note/logo.png" alt="瓜子熊碎碎碎念" class="logo"> <span class="site-name can-hide">瓜子熊碎碎碎念</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/pbad_note/学习路线/" class="nav-link">
  学习路线
</a></div> <a href="https://github.com/guazixiong" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pbad_note/学习路线/" class="nav-link">
  学习路线
</a></div> <a href="https://github.com/guazixiong" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" aria-current="page" class="sidebar-link">免费学习路线</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>学习路线</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pbad_note/学习路线/Mysql快速生成千万数据.html" class="active sidebar-link">Mysql快速生成千万数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pbad_note/学习路线/Mysql快速生成千万数据.html#创建数据库和表" class="sidebar-link">创建数据库和表</a></li><li class="sidebar-sub-header"><a href="/pbad_note/学习路线/Mysql快速生成千万数据.html#不推荐-改造一" class="sidebar-link">(不推荐)改造一</a></li><li class="sidebar-sub-header"><a href="/pbad_note/学习路线/Mysql快速生成千万数据.html#推荐-改造二" class="sidebar-link">(推荐)改造二</a></li></ul></li><li><a href="/pbad_note/学习路线/Java学习路线 by 程序员鱼皮.html" class="sidebar-link">Java 学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/前端学习路线 by 程序员鱼皮.html" class="sidebar-link">前端学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/C++学习路线 by 程序员鱼皮.html" class="sidebar-link">C++ 学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/Python学习路线 by 程序员鱼皮.html" class="sidebar-link">Python 学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/数据结构和算法学习路线 by 程序员鱼皮.html" class="sidebar-link">数据结构和算法学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/SQL免费实战自学网站 by 程序员鱼皮.html" class="sidebar-link">SQL 免费实战自学网站 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/计算机基础学习路线 by 程序员鱼皮.html" class="sidebar-link">计算机基础学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/Git&amp;GitHub学习路线 by 程序员鱼皮.html" class="sidebar-link">Git &amp; GitHub 学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/设计模式学习路线 by 程序员鱼皮.html" class="sidebar-link">设计模式学习路线 by 程序员鱼皮</a></li><li><a href="/pbad_note/学习路线/Linux学习路线 by 程序员鱼皮.html" class="sidebar-link">Linux 学习路线 by 程序员鱼皮</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content"><div style="width:100%"><div class="theme-default-content custom-content content__default"><h1 id="mysql快速生成千万数据"><a href="#mysql快速生成千万数据" class="header-anchor">#</a> Mysql快速生成千万数据</h1> <p>为了创建一个包含大约20个字段的MySQL表，并编写一个存储过程插入大约2亿条数据，我们可以先定义表结构，然后编写存储过程插入数据。以下是一个示例：</p> <blockquote><p>请注意，插入2亿条数据可能会非常耗时，并且可能会占用大量的数据库资源。建议在执行此操作之前确保有足够的资源，并在可能的情况下分批插入数据，以避免锁表或其他性能问题。</p> <p>此外，由于插入2亿条数据是一个非常耗时的操作，建议在实际操作中使用并发插入或批量插入来提高效率。例如，可以编写多个存储过程，每个过程插入一部分数据，或者在应用程序中使用多线程并发插入。</p></blockquote> <h2 id="创建数据库和表"><a href="#创建数据库和表" class="header-anchor">#</a> 创建数据库和表</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> mycat_test<span class="token punctuation">;</span>
<span class="token keyword">USE</span> mycat_test<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test_table <span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    col1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col3 <span class="token keyword">INT</span><span class="token punctuation">,</span>
    col4 <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col5 <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    col6 <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    col7 <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span>
    col8 <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span>
    col9 <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col10 <span class="token keyword">TEXT</span><span class="token punctuation">,</span>
    col11 <span class="token keyword">BLOB</span><span class="token punctuation">,</span>
    col12 <span class="token keyword">MEDIUMTEXT</span><span class="token punctuation">,</span>
    col13 <span class="token keyword">ENUM</span><span class="token punctuation">(</span><span class="token string">'val1'</span><span class="token punctuation">,</span> <span class="token string">'val2'</span><span class="token punctuation">,</span> <span class="token string">'val3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col14 <span class="token keyword">SET</span><span class="token punctuation">(</span><span class="token string">'val1'</span><span class="token punctuation">,</span> <span class="token string">'val2'</span><span class="token punctuation">,</span> <span class="token string">'val3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col15 <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>
    col16 <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    col17 <span class="token keyword">FLOAT</span><span class="token punctuation">,</span>
    col18 <span class="token keyword">DOUBLE</span><span class="token punctuation">,</span>
    col19 <span class="token keyword">YEAR</span><span class="token punctuation">,</span>
    col20 <span class="token keyword">TIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="不推荐-改造一"><a href="#不推荐-改造一" class="header-anchor">#</a> (不推荐)改造一</h2> <h3 id="创建批量插入数据的存储过程"><a href="#创建批量插入数据的存储过程" class="header-anchor">#</a> 创建批量插入数据的存储过程</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> InsertBatchData<span class="token punctuation">(</span><span class="token operator">IN</span> start_id <span class="token keyword">INT</span><span class="token punctuation">,</span> <span class="token operator">IN</span> end_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> start_id<span class="token punctuation">;</span>

    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;=</span> end_id <span class="token keyword">DO</span>
        <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_table <span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">,</span> col3<span class="token punctuation">,</span> col4<span class="token punctuation">,</span> col5<span class="token punctuation">,</span> col6<span class="token punctuation">,</span> col7<span class="token punctuation">,</span> col8<span class="token punctuation">,</span> col9<span class="token punctuation">,</span> col10<span class="token punctuation">,</span> col11<span class="token punctuation">,</span> col12<span class="token punctuation">,</span> col13<span class="token punctuation">,</span> col14<span class="token punctuation">,</span> col15<span class="token punctuation">,</span> col16<span class="token punctuation">,</span> col17<span class="token punctuation">,</span> col18<span class="token punctuation">,</span> col19<span class="token punctuation">,</span> col20<span class="token punctuation">)</span> 
        <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>
            CONCAT<span class="token punctuation">(</span><span class="token string">'value_'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> 
            CONCAT<span class="token punctuation">(</span><span class="token string">'data_'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> 
            i<span class="token punctuation">,</span> 
            i <span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">,</span> 
            CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span> 
            i <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">,</span> 
            <span class="token keyword">LEFT</span><span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            RANDOM_BYTES<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'mediumtext'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token string">'val1'</span><span class="token punctuation">,</span> 
            <span class="token string">'val2'</span><span class="token punctuation">,</span> 
            <span class="token function">MOD</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">32767</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> 
            i <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">,</span> 
            i <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">,</span> 
            <span class="token keyword">YEAR</span><span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="创建控制存储过程"><a href="#创建控制存储过程" class="header-anchor">#</a> 创建控制存储过程</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> InsertAllData<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> start_id <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> end_id <span class="token keyword">INT</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> batch_size <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">100000</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> total_records <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">200000000</span><span class="token punctuation">;</span>

    <span class="token keyword">WHILE</span> start_id <span class="token operator">&lt;=</span> total_records <span class="token keyword">DO</span>
        <span class="token keyword">SET</span> end_id <span class="token operator">=</span> start_id <span class="token operator">+</span> batch_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">CALL</span> InsertBatchData<span class="token punctuation">(</span>start_id<span class="token punctuation">,</span> end_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">SET</span> start_id <span class="token operator">=</span> end_id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="调用控制存储过程"><a href="#调用控制存储过程" class="header-anchor">#</a> 调用控制存储过程</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CALL</span> InsertAllData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过创建控制存储过程 <code>InsertAllData</code>，它会循环调用批量插入数据的存储过程 <code>InsertBatchData</code>，直到插入了所需的全部数据。这样可以避免一次性插入大量数据导致的性能问题，并且可以直接在MySQL中完成所有操作。</p> <p>等待数据插入完毕,实测,2c4g的5分钟才插入了12w条数据,不太行</p> <h2 id="推荐-改造二"><a href="#推荐-改造二" class="header-anchor">#</a> (推荐)改造二</h2> <ul><li><p><strong>关闭自动提交</strong>：在大批量插入数据时，关闭自动提交可以显著提高性能。</p></li> <li><p><strong>批量插入</strong>：使用单个<code>INSERT</code>语句插入多行数据。</p></li> <li><p><strong>禁用索引</strong>：在插入数据前禁用索引，插入完成后再重新启用索引。</p></li> <li><p><strong>调整MySQL配置</strong>：优化MySQL的配置参数，如<code>innodb_buffer_pool_size</code>、<code>bulk_insert_buffer_size</code>等。</p></li></ul> <h3 id="关闭自动提交-使用批量插入"><a href="#关闭自动提交-使用批量插入" class="header-anchor">#</a> 关闭自动提交，使用批量插入</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> InsertAllData<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> start_id <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> end_id <span class="token keyword">INT</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> batch_size <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">-- 每批次插入的行数</span>
    <span class="token keyword">DECLARE</span> total_records <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">20000000</span><span class="token punctuation">;</span> <span class="token comment">-- 2千万条数据</span>

    <span class="token keyword">WHILE</span> start_id <span class="token operator">&lt;=</span> total_records <span class="token keyword">DO</span>
        <span class="token keyword">SET</span> end_id <span class="token operator">=</span> start_id <span class="token operator">+</span> batch_size <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">IF</span> end_id <span class="token operator">&gt;</span> total_records <span class="token keyword">THEN</span>
            <span class="token keyword">SET</span> end_id <span class="token operator">=</span> total_records<span class="token punctuation">;</span>
        <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
        <span class="token keyword">CALL</span> InsertBatchData<span class="token punctuation">(</span>start_id<span class="token punctuation">,</span> end_id<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">SET</span> start_id <span class="token operator">=</span> end_id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="创建控制存储过程-2"><a href="#创建控制存储过程-2" class="header-anchor">#</a> 创建控制存储过程</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> InsertBatchData<span class="token punctuation">(</span><span class="token operator">IN</span> start_id <span class="token keyword">INT</span><span class="token punctuation">,</span> <span class="token operator">IN</span> end_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> start_id<span class="token punctuation">;</span>

    <span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;=</span> end_id <span class="token keyword">DO</span>
        <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_table <span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">,</span> col3<span class="token punctuation">,</span> col4<span class="token punctuation">,</span> col5<span class="token punctuation">,</span> col6<span class="token punctuation">,</span> col7<span class="token punctuation">,</span> col8<span class="token punctuation">,</span> col9<span class="token punctuation">,</span> col10<span class="token punctuation">,</span> col11<span class="token punctuation">,</span> col12<span class="token punctuation">,</span> col13<span class="token punctuation">,</span> col14<span class="token punctuation">,</span> col15<span class="token punctuation">,</span> col16<span class="token punctuation">,</span> col17<span class="token punctuation">,</span> col18<span class="token punctuation">,</span> col19<span class="token punctuation">,</span> col20<span class="token punctuation">)</span> 
        <span class="token keyword">VALUES</span> 
            <span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'value_'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token string">'data_'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">0.01</span><span class="token punctuation">,</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span> i <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RANDOM_BYTES<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'mediumtext'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'val1'</span><span class="token punctuation">,</span> <span class="token string">'val2'</span><span class="token punctuation">,</span> <span class="token function">MOD</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">32767</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>

    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
    <span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="调用控制存储过程-2"><a href="#调用控制存储过程-2" class="header-anchor">#</a> <strong>调用控制存储过程</strong></h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>CALL InsertAllData();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过减小每个批次的大小来避免构建的 SQL 语句过长，同时通过关闭自动提交来减少事务开销，从而提高插入速度。在 <code>InsertBatchData</code> 存储过程中，使用 <code>WHILE</code> 循环逐条插入数据，并在完成后提交事务。</p> <p>等待执行完毕,目前5分钟插入200w条数据,waiting!!!</p></div> <footer class="page-edit" style="margin:0;"><div class="edit-link"><a href="https://github.com/guazixiong/edit/master/学习路线/Mysql快速生成千万数据.md" target="_blank" rel="noopener noreferrer">完善页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" class="prev router-link-active">
        免费学习路线
      </a></span> <span class="next"><a href="/pbad_note/学习路线/Java学习路线 by 程序员鱼皮.html">
        Java 学习路线 by 程序员鱼皮
      </a>
      →
    </span></p></div></div> <div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:86vh"><div style="font-weight:bold;">Mysql快速生成千万数据</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#创建数据库和表" class="toc-sidebar-link">创建数据库和表</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#不推荐-改造一" class="toc-sidebar-link">(不推荐)改造一</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#创建批量插入数据的存储过程" class="toc-sidebar-link">创建批量插入数据的存储过程</a></li><li class="toc-sidebar-sub-header"><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#创建控制存储过程" class="toc-sidebar-link">创建控制存储过程</a></li><li class="toc-sidebar-sub-header"><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#调用控制存储过程" class="toc-sidebar-link">调用控制存储过程</a></li></ul></li><li><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#推荐-改造二" class="toc-sidebar-link">(推荐)改造二</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#关闭自动提交-使用批量插入" class="toc-sidebar-link">关闭自动提交，使用批量插入</a></li><li class="toc-sidebar-sub-header"><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#创建控制存储过程-2" class="toc-sidebar-link">创建控制存储过程</a></li><li class="toc-sidebar-sub-header"><a href="/pbad_note/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/Mysql%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%8D%83%E4%B8%87%E6%95%B0%E6%8D%AE.html#调用控制存储过程-2" class="toc-sidebar-link">调用控制存储过程</a></li></ul></li></ul></div></div></div></div></div>  <main class="footer"> <div class="copy-right"><span class="name"> 编程导航   |     </span> <a target="_blank" rel="noreferrer">
          
        </a></div></main></main> <aside class="page-sidebar"> <div class="page-side-toolbar"></div>  </aside></div><div class="global-ui"><!----></div></div>
    <script src="/pbad_note/assets/js/app.e274ab40.js" defer></script><script src="/pbad_note/assets/js/2.fd06b53e.js" defer></script><script src="/pbad_note/assets/js/33.2b5112ad.js" defer></script>
  </body>
</html>
